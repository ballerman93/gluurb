local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local coreGui = game:GetService("CoreGui")
local UIS = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local originalProps = {}
local toggled = false
local runLoop
local tweakPower = 1
local mode = 1
local includeCoreGui = false
local keepOriginal = true
local tweakDelay = 0.05

local function storeOriginal(element)
    if element:IsA("GuiObject") and not originalProps[element] and element ~= button then
        originalProps[element] = {
            Position = element.Position,
            Size = element.Size,
            Rotation = element.Rotation
        }
    end
    for _, child in pairs(element:GetChildren()) do
        storeOriginal(child)
    end
end

local function restoreElement(element)
    if element:IsA("GuiObject") and element ~= button then
        local original = originalProps[element]
        if original then
            element.Position = original.Position
            element.Size = original.Size
            element.Rotation = original.Rotation
        end
    end
end

local function tweakElement(element)
    if not element:IsA("GuiObject") or element == button then return end
    local original = keepOriginal and originalProps[element] or {Position=element.Position, Size=element.Size, Rotation=element.Rotation}
    if not original then return end
    if mode == 1 then
        local offsetX = math.random(-tweakPower, tweakPower)
        local offsetY = math.random(-tweakPower, tweakPower)
        local sizeX = math.random(-tweakPower, tweakPower)
        local sizeY = math.random(-tweakPower, tweakPower)
        local rotationOffset = math.random(-tweakPower*3, tweakPower*3)
        element.Position = original.Position + UDim2.new(0, offsetX, 0, offsetY)
        element.Size = original.Size + UDim2.new(0, sizeX, 0, sizeY)
        element.Rotation = original.Rotation + rotationOffset
    elseif mode == 2 then
        local offsetX = math.random(-tweakPower, tweakPower)
        local offsetY = math.random(-tweakPower, tweakPower)
        element.Position = original.Position + UDim2.new(0, offsetX, 0, offsetY)
    elseif mode == 3 then
        local sizeX = math.random(-tweakPower, tweakPower)
        local sizeY = math.random(-tweakPower, tweakPower)
        element.Size = original.Size + UDim2.new(0, sizeX, 0, sizeY)
    elseif mode == 4 then
        local rotationOffset = math.random(-tweakPower*3, tweakPower*3)
        element.Rotation = original.Rotation + rotationOffset
    end
end

local function scanGuis()
    originalProps = {}
    storeOriginal(playerGui)
    if includeCoreGui then
        storeOriginal(coreGui)
    end
end

scanGuis()
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = playerGui
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 250, 0, 90)
button.Position = UDim2.new(0.5, -125, 0.5, -45)
button.BorderColor3 = Color3.fromRGB(0, 0, 0)
button.BorderSizePixel = 5
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.TextScaled = true
button.TextWrapped = true
button.Text = ""
button.Font = Enum.Font.SourceSansBold
button.Active = true
button.Draggable = true
button.Parent = screenGui
local function die()
    button.Text = 
        "Power: "..tweakPower..
        "\nMode: "..mode..
        "\nOriginal Pos: "..tostring(keepOriginal)..
        "\nCoreGui Included: "..tostring(includeCoreGui)..
        "\nDelay: "..tostring(tweakDelay)
    local r = tweakPower/10
    local g = keepOriginal and 0.8 or 0.3
    local b = mode/4
    button.BackgroundColor3 = Color3.new(r, g, b)
end

die()
button.MouseButton1Click:Connect(function()
    tweakPower = tweakPower + 1
    if tweakPower > 10 then tweakPower = 0 end
    die()
    if tweakPower > 0 and not toggled then
        toggled = true
        runLoop = true
        spawn(function()
            while runLoop do
                for element, _ in pairs(originalProps) do
                    tweakElement(element)
                end
                wait(tweakDelay)
            end
        end)
    elseif tweakPower == 0 then
        toggled = false
        runLoop = false
        for element, _ in pairs(originalProps) do
            restoreElement(element)
        end
    end
end)

button.MouseButton2Click:Connect(function()
    mode = mode + 1
    if mode > 4 then mode = 1 end
    die()
end)

UIS.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.PageUp then
        keepOriginal = not keepOriginal
        die()
    elseif input.KeyCode == Enum.KeyCode.PageDown then
        includeCoreGui = not includeCoreGui
        scanGuis()
        die()
    elseif input.KeyCode == Enum.KeyCode.Home then
        tweakDelay = tweakDelay + 0.05
        if tweakDelay > 0.5 then tweakDelay = 0 end
        die()
    elseif input.KeyCode == Enum.KeyCode.End then
        TeleportService:Teleport(game.PlaceId, player)
    end
end)
